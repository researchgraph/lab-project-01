export function forceGraph(t,e,n,{nodeStrokeWidth:r=1.5,nodeStrokeOpacity:a=1,nodeRadius:o=10,strength:s=-200,linkSource:i=({source:t})=>t,linkTarget:l=({target:t})=>t,linkStrokeOpacity:c=.6,linkStrokeWidth:d=1.5,width:u=640,height:p=400,nodeRadiusDuration:f,graphTransition:h=500}={}){let{nodes:y,links:$}=convertData(t),m=e.map(y,t=>t.key).map(D),g=e.map($,i).map(D),x=e.map($,l).map(D),k=e.map(y,t=>t.title||t.full_name||t.name),b=e.map(y,t=>t.group).map(D),_="function"!=typeof d?null:e.map($,d),v=!1;y=e.map(y,(t,e)=>({id:m[e]})),$=e.map($,(t,e)=>({source:g[e],target:x[e]}));let C=e.forceLink($).id(({index:t})=>m[t]);var L=e.zoom().scaleExtent([.1,10]).on("zoom",function(t){e.select(".node").attr("transform",t.transform),e.select(".lines").attr("transform",t.transform);var n=t.transform.k;n<.8?(e.selectAll(".text-box").style("display","none"),e.selectAll(".text-box-content").style("display","none")):(e.selectAll(".text-box").style("display","block"),e.selectAll(".text-box-content").style("display","block")),n<.4?e.selectAll(".material-icons-round").style("display","none"):e.selectAll(".material-icons-round").style("display","block")});let w=e.forceSimulation(y).force("link",C).force("charge",e.forceManyBody().strength(s)).force("center",e.forceCenter()).on("tick",function t(){A.transition().duration(h).ease(e.easeLinear).attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),B.transition().duration(h).ease(e.easeLinear).attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}),j=e.select("body").append("svg").attr("width",u).attr("height",p).attr("viewBox",[-u/2,-p/2,u,p]).attr("style","max-width: 100%; height: auto; height: intrinsic;").call(L),A=j.append("g").attr("class","lines").attr("stroke","#999").attr("stroke-opacity",c).attr("stroke-width","function"!=typeof d?d:null).attr("stroke-linecap","round").selectAll("line").data($).join("line");var E,B=j.append("g").attr("class","node").selectAll("g").data(y).enter().append("g").call((E=w,e.drag().on("start",function t(e){e.active||v||E.alphaTarget(.3).restart(),e.subject.fx=e.subject.x,e.subject.fy=e.subject.y}).on("drag",function t(e){e.subject.fx=e.x,e.subject.fy=e.y}).on("end",function t(e){e.active||v||E.alphaTarget(0),e.subject.fx=null,e.subject.fy=null})));B.append("circle").attr("r",o).attr("stroke",({index:t})=>getStrokeColor(b[t])).attr("stroke-opacity",a).attr("fill",({index:t})=>getColor(b[t])).attr("stroke-width",r),B.append("text").attr("x",-6).attr("y",6).attr("class","material-icons-round").attr("font-family","Material Icons").text(function(t,e){return getIcon(b[e])}),L.scaleBy(j.transition().duration(h),.4),B.on("mouseover",function(t,n){v||w.force("x",null).force("y",null).alpha(.1).restart();let r=[];r.push(n.id),$.forEach(function(t){t.source.id===n.id&&r.push(t.target.id),t.target.id===n.id&&r.push(t.source.id)}),j.selectAll("circle").each(function(t,n){r.includes(t.id)&&e.select(this).transition().duration(f).attr("r",o+10)})}).on("mouseout",function(t){j.selectAll("circle").transition().duration(100).attr("r",o)});let G=()=>{L.scaleBy(j.transition().duration(h),1.2)},I=()=>{L.scaleBy(j.transition().duration(h),1/1.2)},F=()=>{j.transition().duration(h).call(L.transform,e.zoomIdentity.translate(0,0).scale(.4)),w.alpha(1).restart()},z=()=>{(v=!v)?w.alpha(0).stop():w.alpha(.1).restart()};function D(t){return null!==t&&"object"==typeof t?t.valueOf():t}_&&A.attr("stroke-width",({index:t})=>_[t]),k&&B.append("title").text(({index:t})=>k[t]);let M=n`
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <style> .material-icons-round { font-family: 'Material Icons', serif; font-size: 12.5px; fill: white; weight: 100; grade: -25; } </style>
      <div style="position: relative"></div>`,S=n`<div style="position: absolute; top: 0; left: 0; margin: 5px"></div>`;M.appendChild(S);let P=n`<button>+</button>`;P.addEventListener("click",()=>G()),S.appendChild(P);let T=n`<button>âˆ’</button>`;T.addEventListener("click",()=>I()),S.appendChild(T);let O=n`<button>Reset</button>`;O.addEventListener("click",()=>F()),S.appendChild(O);let R=n`<button>Pause/Play</button>`;return R.addEventListener("click",()=>z()),S.appendChild(R),M.appendChild(j.node()),M}export function transformLinks(t){let e=[];for(let n=0;n<t.length;n++){let r=t[n],a={source:r.from,target:r.to};e.push(a)}return e}export function addGroup(t,e){let n=[];for(let r=0;r<t.length;r++){let a=t[r];a.group=e,n.push(a)}return n}export function convertData(t){let e={nodes:[],links:[]};return e.nodes=addGroup(t[0].nodes.datasets,1),e.nodes.push(...addGroup(t[0].nodes.researchers,2)),e.nodes.push(...addGroup(t[0].nodes.grants,3)),e.nodes.push(...addGroup(t[0].nodes.organisations,4)),e.nodes.push(...addGroup(t[0].nodes.publications,5)),e.links=transformLinks(t[0].relationships["researcher-dataset"]),e.links.push(...transformLinks(t[0].relationships["researcher-grant"])),e.links.push(...transformLinks(t[0].relationships["researcher-organisation"])),e.links.push(...transformLinks(t[0].relationships["researcher-publication"])),e.links.push(...transformLinks(t[0].relationships["researcher-researcher"])),e}export function getColor(t){let e=new Map([[1,"#EB6E1F"],[2,"#63CC9E"],[3,"#FFD66C"],[4,"#9662D0"],[5,"#55BFF6"]]);return e.get(t)}export function getStrokeColor(t){let e=new Map([[1,"#b84a03"],[2,"#56b38c"],[3,"#f3b835"],[4,"#65428e"],[5,"#4ba9dc"]]);return e.get(t)}export function getIcon(t){let e=new Map([[1,"storage"],[2,"person"],[3,"description"],[4,"account_balance"],[5,"library_books"]]);return e.get(t)}